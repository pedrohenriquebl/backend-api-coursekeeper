generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  firstName              String
  lastName               String
  email                  String            @unique
  password               String
  cpf                    String            @unique
  profileImage           String?
  description            String?
  createdAt              DateTime          @default(now())
  updatedAt              DateTime          @updatedAt
  deletedAt              DateTime?
  id                     Int               @id @default(autoincrement())
  currentLoginStreak     Int               @default(0)
  github                 String?
  lastLogin              DateTime?
  linkedin               String?
  maxLoginStreak         Int               @default(0)
  website                String?
  subscriptionPlan       SubscriptionPlan  @default(FREE)
  subscriptionValidUntil DateTime?
  acceptedPrivacyAt      DateTime?
  acceptedTermsAt        DateTime?
  chatMessages           ChatMessage[]
  courses                Course[]
  goals                  Goal[]
  UserAchievement        UserAchievement[]
}

model Course {
  id             Int          @id @default(autoincrement())
  name           String
  platform       Platform
  platformCustom String?
  topic          Topic
  topicCustom    String?
  progress       Int          @default(0)
  rating         Int          @default(0)
  comment        String?
  status         CourseStatus
  startDate      DateTime
  endDate        DateTime?
  description    String?
  instructor     String?
  language       Language?
  languageCustom String?
  userId         Int
  createdAt      DateTime     @default(now())
  deletedAt      DateTime?
  updatedAt      DateTime     @updatedAt
  studiedHours   Int          @default(0)
  duration       Int          @default(0)
  user           User         @relation(fields: [userId], references: [id])
}

model Goal {
  id            Int        @id @default(autoincrement())
  title         String
  type          GoalType
  target        Int
  current       Int        @default(0)
  topic         Topic?
  deadline      DateTime
  status        GoalStatus
  createdAt     DateTime   @default(now())
  completedAt   DateTime?
  description   String?
  userId        Int
  isActive      Boolean    @default(true)
  unit          GoalUnits
  updatedAt     DateTime   @updatedAt
  streakAtStart Int?
  user          User       @relation(fields: [userId], references: [id])
}

model UserAchievement {
  id            Int         @id @default(autoincrement())
  userId        Int
  achievementId Int
  unlockedAt    DateTime    @default(now())
  achievement   Achievement @relation(fields: [achievementId], references: [id])
  user          User        @relation(fields: [userId], references: [id])

  @@unique([userId, achievementId])
}

model Achievement {
  id               Int               @id @default(autoincrement())
  code             String            @unique
  name             String
  description      String
  icon             String?
  condition        String?
  userAchievements UserAchievement[]
}

model ChatMessage {
  id        Int      @id @default(autoincrement())
  userId    Int
  role      ChatRole
  message   String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

enum ChatRole {
  USER
  ASSISTANT
}

enum Topic {
  FRONTEND
  BACKEND
  DEVOPS
  FULLSTACK
  MOBILE
  DATASCIENCE
  DESIGN
  OUTROS
  DATABASE
}

enum Platform {
  EDX
  UDEMY
  ALURA
  ROCKETSEAT
  COURSERA
  VUEMASTERY
  YOUTUBE
  OUTROS
}

enum CourseStatus {
  NAO_INICIADO
  EM_PROGRESSO
  CONCLUIDO
  NAO_CONCLUIDO
}

enum GoalType {
  HORAS_TOTAIS
  HORAS_TOPICO
  CURSOS_CONCLUIDOS
  PERIODO_ESTUDO
}

enum GoalStatus {
  ATIVA
  CONCLUIDA
  VENCIDA
}

enum GoalUnits {
  HORAS
  CURSOS
  DIAS
}

enum Language {
  PORTUGUES
  INGLES
  ESPANHOL
  FRANCES
  OUTROS
}

enum SubscriptionPlan {
  FREE
  GOLD
  PLATINUM
}
